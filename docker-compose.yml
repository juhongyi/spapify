services:
  database:
    image: postgres:17-alpine
    ports:
      - 5432:5432
    environment:
      - POSTGRES_USER=$DB_USER
      - POSTGRES_PASSWORD=$DB_PASSWORD
    volumes:
      - database_volume:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped
  metabase:
    image: metabase/metabase:latest
    ports:
      - 3000:3000
    environment:
      - MB_DB_TYPE=postgres
      - MB_DB_HOST=$MB_DB_HOST
      - MB_DB_DBNAME=$MB_DB_NAME
      - MB_DB_USER=$MB_DB_USER
      - MB_DB_PASS=$MB_DB_PASSWORD
    depends_on:
      - metabase-database
    restart: unless-stopped
  metabase-database:
    image: postgres:17-alpine
    ports:
      - 5433:5432
    environment:
      - POSTGRES_DB=$MB_DB_NAME
      - POSTGRES_USER=$MB_DB_USER
      - POSTGRES_PASSWORD=$MB_DB_PASSWORD
    volumes:
      - metabase_database_volume:/var/lib/postgresql/data
    restart: unless-stopped
volumes:
  database_volume:
  metabase_database_volume:
